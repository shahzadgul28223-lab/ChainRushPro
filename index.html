<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChainRush Pro | Official Verified</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.1/web3.min.js"></script>
    <style>
        :root { --gold: #f3ba2f; --blue: #38bdf8; --bg: #0b0e11; --card: #161a1e; --green: #2ecc71; --red: #e74c3c; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding-bottom: 80px; overflow-x: hidden; }
        .header { background: linear-gradient(180deg, #1e40af, #0b0e11); padding: 30px 20px; text-align: center; border-bottom: 3px solid var(--gold); }
        .user-avatar { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--gold); margin: 10px auto; display: block; object-fit: cover; }
        .referral-box { background: rgba(56, 189, 248, 0.1); border: 1px dashed var(--blue); margin: 15px; padding: 15px; border-radius: 12px; text-align: center; }
        .ref-link-input { background: #000; border: 1px solid #444; color: var(--gold); padding: 10px; width: 90%; border-radius: 8px; font-size: 12px; margin-bottom: 10px; text-align: center; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; }
        .box { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid #333; text-align: center; }
        .box h4 { margin: 0; font-size: 10px; color: #888; text-transform: uppercase; }
        .box p { margin: 5px 0 0; font-size: 16px; color: var(--gold); font-weight: bold; }
        .report-section { background: var(--card); margin: 15px; padding: 15px; border-radius: 12px; border: 1px solid #333; }
        .report-header { color: var(--blue); font-size: 14px; border-bottom: 1px solid #333; padding-bottom: 8px; margin-bottom: 10px; font-weight: bold; }
        .team-row { display: flex; justify-content: space-between; font-size: 11px; padding: 8px 0; border-bottom: 1px solid #222; }
        .admin-panel { background: #1a1d21; margin: 15px; padding: 15px; border-radius: 12px; border: 2px solid var(--red); display: none; }
        .plan-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 15px; }
        .plan-card { background: #1e2329; padding: 20px 10px; border-radius: 20px; text-align: center; border: 1px solid #333; position: relative; }
        .active-tag { position: absolute; top: 5px; right: 5px; background: var(--green); font-size: 8px; padding: 2px 5px; border-radius: 4px; display: none; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-blue { background: var(--blue); color: white; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-red { background: var(--red); color: white; margin-top: 10px; }
        input, select { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #444; background: #000; color: white; margin-top: 8px; }
        #notify-toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); z-index: 100000; background: var(--blue); padding: 10px 20px; border-radius: 20px; display: none; }
    </style>
</head>
<body>

<div id="notify-toast">Notification</div>

<div class="header">
    <button onclick="connectWallet()" class="btn btn-blue" id="wallet-btn" style="width:auto; margin-bottom:10px;">Connect Wallet</button>
    <div id="wallet-addr" style="font-size: 10px; color: #888;">Not Connected</div>
    <div id="user-display-id" style="font-size: 22px; color: var(--gold); font-weight: bold;">ID: ----</div>
    <img src="https://i.pravatar.cc/150?u=4510" id="user-avatar-img" class="user-avatar">
</div>

<div class="admin-panel" id="admin-panel">
    <h4 style="margin:0; color:var(--red); text-align:center;">ADMIN: GIFT LEVEL</h4>
    <input type="text" id="target-id" placeholder="Enter User Wallet Address">
    <select id="gift-level-select">
        <option value="1">Level 1 - Active</option>
        <option value="2">Level 2 - Active</option>
        <option value="3">Level 3 - Active</option>
        <option value="4">Level 4 - Active</option>
        <option value="5">Level 5 - Active</option>
        <option value="6">Level 6 - Active</option>
        <option value="7">Level 7 - Active</option>
        <option value="8">Level 8 - Active</option>
        <option value="9">Level 9 - Active</option>
        <option value="10">Level 10 - Active</option>
        <option value="11">Level 11 - Active</option>
        <option value="12">Level 12 - Active</option>
    </select>
    <button onclick="adminGiftLevel()" class="btn btn-red">GIFT NOW</button>
</div>

<div class="referral-box">
    <input type="text" id="ref-url" class="ref-link-input" readonly value="">
    <button onclick="copyLink()" class="btn btn-gold" style="width:120px; padding:8px;">COPY LINK</button>
</div>

<div class="stats-grid">
    <div class="box"><h4>Active Level</h4><p id="stat-level">0</p></div>
    <div class="box"><h4>Team Income</h4><p id="stat-total">$0.00</p></div>
    <div class="box"><h4>Direct Team</h4><p id="stat-direct-team">0</p></div>
    <div class="box"><h4>Total Team</h4><p id="stat-total-team">0</p></div>
</div>

<div class="report-section">
    <div class="report-header">TEAM REPORT (LIVE)</div>
    <div class="team-row"><span>Direct Members</span><span id="t-l1" style="color:var(--gold)">0</span></div>
    <div class="team-row"><span>Total Network</span><span id="t-total-net" style="color:var(--gold)">0</span></div>
</div>

<div class="plan-grid" id="level-grid"></div>

<script>
    const OWNER = "0x40642a42eb9edbf936c5da1ae71e5d762a3b0f46".toLowerCase();
    const PRICING = [30, 60, 120, 240, 480, 960, 1920, 3840, 7680, 15360, 30720, 61440];
    
    let web3;
    let currentAccount = "";
    let userPlans = 0;

    async function connectWallet() {
        if (window.ethereum) {
            web3 = new Web3(window.ethereum);
            const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
            currentAccount = accounts[0].toLowerCase();
            
            document.getElementById('wallet-addr').innerText = currentAccount;
            
            let userID = localStorage.getItem('id_' + currentAccount);
            if(!userID) {
                userID = Math.floor(1000 + Math.random() * 9000);
                localStorage.setItem('id_' + currentAccount, userID);
                localStorage.setItem('wallet_of_' + userID, currentAccount);
            }
            document.getElementById('user-display-id').innerText = "ID: " + userID;
            document.getElementById('ref-url').value = window.location.origin + "/?ref=" + userID;
            document.getElementById('user-avatar-img').src = `https://i.pravatar.cc/150?u=${userID}`;

            if(currentAccount === OWNER) {
                userPlans = 12;
                document.getElementById('admin-panel').style.display = 'block';
            } else {
                userPlans = parseInt(localStorage.getItem('plans_' + currentAccount) || 0);
                document.getElementById('admin-panel').style.display = 'none';
            }
            
            processReferral(userID);
            loadStats();
            renderLevels();
            toast("Connected!");
        }
    }

    function processReferral(myID) {
        const urlParams = new URLSearchParams(window.location.search);
        const refID = urlParams.get('ref');
        
        if (refID && refID !== myID && !localStorage.getItem('registered_' + currentAccount)) {
            let upliner = localStorage.getItem('wallet_of_' + refID);
            if(upliner) {
                upliner = upliner.toLowerCase();
                localStorage.setItem('ref_wallet_' + currentAccount, upliner);
                localStorage.setItem('registered_' + currentAccount, "true");
                
                // ٹیم اپ ڈیٹ
                let dTeam = parseInt(localStorage.getItem('d_count_' + upliner) || 0);
                localStorage.setItem('d_count_' + upliner, dTeam + 1);
                
                // نیٹ ورک اپ ڈیٹ (5 لیول تک)
                let ptr = upliner;
                for(let i=0; i<5; i++) {
                    if(!ptr) break;
                    let tCount = parseInt(localStorage.getItem('t_count_' + ptr) || 0);
                    localStorage.setItem('t_count_' + ptr, tCount + 1);
                    ptr = localStorage.getItem('ref_wallet_' + ptr);
                }
            }
        }
    }

    function loadStats() {
        const d = localStorage.getItem('d_count_' + currentAccount) || "0";
        const t = localStorage.getItem('t_count_' + currentAccount) || "0";
        document.getElementById('stat-level').innerText = userPlans;
        document.getElementById('stat-direct-team').innerText = d;
        document.getElementById('stat-total-team').innerText = t;
        document.getElementById('t-l1').innerText = d;
        document.getElementById('t-total-net').innerText = t;
    }

    function renderLevels() {
        const grid = document.getElementById('level-grid');
        grid.innerHTML = '';
        PRICING.forEach((price, i) => {
            const lvl = i + 1;
            const active = lvl <= userPlans;
            grid.innerHTML += `
                <div class="plan-card" style="border-color: ${active ? 'var(--green)' : '#333'}">
                    <span class="active-tag" style="display: ${active ? 'block' : 'none'}">ACTIVE</span>
                    <h3>LEVEL ${lvl}</h3>
                    <p>$${price}</p>
                    <button class="btn ${active ? 'btn-blue' : 'btn-gold'}" disabled style="opacity:${active ? '1' : '0.3'}">
                        ${active ? 'PURCHASED' : 'LOCKED'}
                    </button>
                </div>`;
        });
    }

    function adminGiftLevel() {
        const addr = document.getElementById('target-id').value.trim().toLowerCase();
        const lvl = document.getElementById('gift-level-select').value;
        if(addr.length < 40) return alert("Valid Wallet Required");
        
        localStorage.setItem('plans_' + addr, lvl);
        toast("Level " + lvl + " Gifted!");
        document.getElementById('target-id').value = "";
        
        if(currentAccount === addr) {
            userPlans = parseInt(lvl);
            renderLevels();
            loadStats();
        }
    }

    function toast(m) {
        const t = document.getElementById('notify-toast');
        t.innerText = m; t.style.display = "block";
        setTimeout(() => t.style.display = "none", 3000);
    }

    function copyLink() {
        navigator.clipboard.writeText(document.getElementById("ref-url").value);
        toast("Link Copied!");
    }

    window.onload = () => { if(!currentAccount) renderLevels(); };
</script>
</body>
</html>
